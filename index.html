<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>Babylon.js sample code</title>

    <!-- Babylon.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
    <script src="https://assets.babylonjs.com/generated/Assets.js"></script>
    <script src="https://preview.babylonjs.com/ammo.js"></script>
    <script src="https://preview.babylonjs.com/cannon.js"></script>
    <script src="https://preview.babylonjs.com/Oimo.js"></script>
    <script src="https://preview.babylonjs.com/earcut.min.js"></script>
    <script src="https://preview.babylonjs.com/babylon.js"></script>
    <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
    <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
    <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
    <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
    <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
    <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

    <style>
        html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        var canvas = document.getElementById("renderCanvas");

        var startRenderLoop = function (engine, canvas) {
            engine.runRenderLoop(function () {
                if (sceneToRender && sceneToRender.activeCamera) {
                    sceneToRender.render();
                }
            });
        }

        var engine = null;
        var scene = null;
        var sceneToRender = null;
        var createDefaultEngine = function () { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true, disableWebGL2Support: false }); };
        var createScene = function () {
            var scene = new BABYLON.Scene(engine);

            //Adding a light
            var light = new BABYLON.PointLight("Omni", new BABYLON.Vector3(20, 20, 10), scene);
            var light1 = new BABYLON.HemisphericLight("HemiLight", new BABYLON.Vector3(5, 10, 5), scene);

            //Adding an Arc Rotate Camera
            var camera = new BABYLON.ArcRotateCamera("Camera", 0, 0.5, 10, BABYLON.Vector3.Zero(), scene);
            camera.attachControl(canvas, true);

            // The first parameter can be used to specify which mesh to import. Here we import all meshes
            const resultPromise = BABYLON.SceneLoader.ImportMeshAsync("", "scenes/", "scene.babylon", scene);

            // Result has meshes, particleSystems, skeletons, animationGroups and transformNodes
            resultPromise.then((result) => {
                camera.target = result.meshes[0];
                  //==============MESHES============
                //meshes[0] - karkas, meshes[2] - floor, meshes[2] - sidushkaMat.                
           // result.meshes[2].material = karkasMat;
           // result.meshes[0].material = sidushkaMat;
            //-----------------------------------------------------------------------
                
            });

            // Move the light with the camera
            scene.registerBeforeRender(function () {
                light.position = camera.position;
            });
            
          

            //==============MATERIALS============
            //var karkasMat = new BABYLON.PBRMetallicRoughnessMaterial("pbrKarks", scene);
                        var karkasMat = resultPromise.getMaterialByName("Material");

           // karkasMat.baseColor = new BABYLON.Color3(1.0, 0.766, 0.336);
           // karkasMat.metallic = 0;
           // karkasMat.roughness = 1.0;

           

           // var sidushkaMat = new BABYLON.PBRMetallicRoughnessMaterial("pbrSidshk", scene);
                       var sidushkaMat = resultPromise.getMaterialByName("Material");

            // sidushkaMat.baseColor = new BABYLON.Color3(0.94, 0.38, 0.07);
            // sidushkaMat.metallic = 0;
            // sidushkaMat.roughness = 1.0;
           

            //-----------------------------------------------------------------------

 //=================GUI==============

            // advancedTexture---
            var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("GUI", true, scene);
            
            // Set the ideal W and H if you wish to scale with the window.
            advancedTexture.idealWidth = 1024;
            advancedTexture.idealHeight = 1024;

            var editBtn = BABYLON.GUI.Button.CreateSimpleButton("editBtn", "Редактировать");
            editBtn.width = 0.25;
            editBtn.height = "40px";
            editBtn.background = "green";
            editBtn.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            editBtn.color = "white";
            advancedTexture.addControl(editBtn);

            //First Grid---
            var firstGrid = new BABYLON.GUI.Grid("firstGrid");
            firstGrid.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
            firstGrid.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            firstGrid.width = "90%";
            firstGrid.height = 0.25;
            firstGrid.background = "gray";
            firstGrid.alpha = 0.7;
            firstGrid.isVisible = false;
                //Rows and Columns
            firstGrid.addRowDefinition(0.25);
            firstGrid.addRowDefinition(0.25);
            firstGrid.addRowDefinition(0.25);
            firstGrid.addRowDefinition(0.25);
            firstGrid.addColumnDefinition(0.5);
            firstGrid.addColumnDefinition(0.5);
            advancedTexture.addControl(firstGrid);

            // Текстовые блоки
            var textAxisX = new BABYLON.GUI.TextBlock("textAxisX");
            textAxisX.text = "Ось X. Поворот 0";
            textAxisX.color = "white";
            firstGrid.addControl(textAxisX, 1, 0);

            var textAxisY = new BABYLON.GUI.TextBlock("textAxisY");
            textAxisY.text = "Ось Y. Поворот 0";
            textAxisY.color = "white";
            firstGrid.addControl(textAxisY, 2, 0);

            var textAxisZ = new BABYLON.GUI.TextBlock("textAxisZ");
            textAxisZ.text = "Ось Z. Поворот 0";
            textAxisZ.color = "white";
            firstGrid.addControl(textAxisZ, 3, 0);

            //Слайдеры
            var xSlider = new BABYLON.GUI.Slider("xSlider");
            xSlider.width = 0.9;
            xSlider.height = 0.7;
            xSlider.color = "green";
            xSlider.background = "white";
            xSlider.barOffset = "6px";
            xSlider.minimum = 0;
            xSlider.maximum = 2 * Math.PI;
            xSlider.value = 0;
            firstGrid.addControl(xSlider, 1, 1);

            var ySlider = new BABYLON.GUI.Slider("ySlider");
            ySlider.width = 0.9;
            ySlider.height = 0.7;
            ySlider.color = "green";
            ySlider.background = "white";
            ySlider.barOffset = "6px";
            ySlider.minimum = 0;
            ySlider.maximum = 2 * Math.PI;
            ySlider.value = 0;
            firstGrid.addControl(ySlider, 2, 1);

            var zSlider = new BABYLON.GUI.Slider("zSlider");
            zSlider.width = 0.9;
            zSlider.height = 0.7;
            zSlider.color = "green";
            zSlider.background = "white";
            zSlider.barOffset = "6px";
            zSlider.minimum = 1.75;
            zSlider.maximum = 8;
            zSlider.value = 0;
            firstGrid.addControl(zSlider, 3, 1);


            // Кнопки

            var SidshkBtn = BABYLON.GUI.Button.CreateSimpleButton("SidshkBtn", "Сидение");
            SidshkBtn.width = 0.4;
            SidshkBtn.left = "25.30%";
            SidshkBtn.paddingRight = 0;
            SidshkBtn.paddingLeft = 0;
            SidshkBtn.background = "green";
            SidshkBtn.color = "white";
            SidshkBtn.alpha = 1.0;
            firstGrid.addControl(SidshkBtn, 0, 0);

            var karksBtn = BABYLON.GUI.Button.CreateSimpleButton("SidshkBtn", "Каркас");
            karksBtn.width = 0.4;
            karksBtn.left ="-21.6%"
            karksBtn.background = "green";
            karksBtn.color = "white";
            karksBtn.alpha = 1.0;
            firstGrid.addControl(karksBtn, 0, 0);

            var closeEditBtn = BABYLON.GUI.Button.CreateSimpleButton("closeEditBtn", "Выйти")
            closeEditBtn.width = 0.5;
            closeEditBtn.background = "red";
            closeEditBtn.color = "white";
            firstGrid.addControl(closeEditBtn, 0, 1);
            //----------------------------------------------------------
            //sidshkTextureGrid---
            var sidshkTextureGrid = new BABYLON.GUI.Grid("firstGrid");
            sidshkTextureGrid.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
            sidshkTextureGrid.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            sidshkTextureGrid.width = 0.67;
            sidshkTextureGrid.height = 0.33;
            sidshkTextureGrid.background = "gray";
            sidshkTextureGrid.alpha = 0.7;
            sidshkTextureGrid.isVisible = false;
            //Rows and Columns
            sidshkTextureGrid.addRowDefinition(0.4);
            sidshkTextureGrid.addRowDefinition(0.4);
            sidshkTextureGrid.addRowDefinition(0.2);
            sidshkTextureGrid.addColumnDefinition(0.5);
            sidshkTextureGrid.addColumnDefinition(0.5);
            advancedTexture.addControl(sidshkTextureGrid);
            // Текстовые блоки
            var sidshkTextureNameText = new BABYLON.GUI.TextBlock("name");
            sidshkTextureNameText.text = "Текстура: ";
            sidshkTextureNameText.color = "white";
            sidshkTextureGrid.addControl(sidshkTextureNameText, 2, 0); 
            //-----------------------------------------------------------

            // Кнопки          
            var textrBtn01 = BABYLON.GUI.Button.CreateImageOnlyButton(
                "textrBtn01", "textures/ikon05.png"
            );
            textrBtn01.width = 0.5;
            textrBtn01.height = 0.9;
            textrBtn01.left = "10%";

            sidshkTextureGrid.addControl(textrBtn01,0,0);

            var textrBtn02 = BABYLON.GUI.Button.CreateImageOnlyButton(
                "textrBtn02", "textures/ikon06.png"
            );
            textrBtn02.width = 0.5;
            textrBtn02.height = 0.9;
            textrBtn02.left = "-10%";
            sidshkTextureGrid.addControl(textrBtn02, 0, 1);


            var textrBtn03 = BABYLON.GUI.Button.CreateImageOnlyButton(
                "textrBtn03", "textures/ikon07.png"
            );
            textrBtn03.width = 0.5;
            textrBtn03.height = 0.9;
            textrBtn03.left = "10%";
            sidshkTextureGrid.addControl(textrBtn03, 1, 0);


            var textrBtn04 = BABYLON.GUI.Button.CreateImageOnlyButton(
                "textrBtn04", "textures/ikon08.png"
            );
            textrBtn04.width = 0.5;
            textrBtn04.height = 0.9;
            textrBtn04.left = "-10%";
            sidshkTextureGrid.addControl(textrBtn04, 1, 1);

            var closeBtn = BABYLON.GUI.Button.CreateSimpleButton("closeBtn", "X");
            closeBtn.width = 0.5;
            closeBtn.height = 0.9;
            closeBtn.background = "red";
            closeBtn.color = "white";
            closeBtn.left = "-10%";
            sidshkTextureGrid.addControl(closeBtn, 2, 1);


            //----------------------------------------------------------
            // karksTextureGrid---
            var karksTextureGrid = new BABYLON.GUI.Grid("firstGrid");
            karksTextureGrid.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
            karksTextureGrid.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            karksTextureGrid.width = 0.67;
            karksTextureGrid.height = 0.33;
            karksTextureGrid.background = "gray";
            karksTextureGrid.alpha = 0.7;
            karksTextureGrid.isVisible = false;
            //Rows and Columns
            karksTextureGrid.addRowDefinition(0.4);
            karksTextureGrid.addRowDefinition(0.4);
            karksTextureGrid.addRowDefinition(0.2);
            karksTextureGrid.addColumnDefinition(0.5);
            karksTextureGrid.addColumnDefinition(0.5);
            advancedTexture.addControl(karksTextureGrid);
            
            // Текстовые блоки
            var karksTextureNameText = new BABYLON.GUI.TextBlock();
            karksTextureNameText.text = "Текстура: ";
            karksTextureNameText.color = "white";
            karksTextureGrid.addControl(karksTextureNameText, 2, 0); 
            
            // Кнопки
            var textrBtn05 = BABYLON.GUI.Button.CreateImageOnlyButton(
                "textrBtn05", "textures/ikon01.png"
            );
            textrBtn05.width = 0.5;
            textrBtn05.height = 0.9;
            textrBtn05.left = "10%";
            karksTextureGrid.addControl(textrBtn05, 0, 0);

            var textrBtn06 = BABYLON.GUI.Button.CreateImageOnlyButton(
                "textrBtn06", "textures/ikon02.png"
            );
            textrBtn06.width = 0.5;
            textrBtn06.height = 0.9;
            textrBtn06.left = "-10%";
            karksTextureGrid.addControl(textrBtn06, 0, 1);


            var textrBtn07 = BABYLON.GUI.Button.CreateImageOnlyButton(
                "textrBtn07", "textures/ikon03.png"
            );
            textrBtn07.width = 0.5;
            textrBtn07.height = 0.9;
            textrBtn07.left = "10%";
            karksTextureGrid.addControl(textrBtn07, 1, 0);

            var textrBtn08 = BABYLON.GUI.Button.CreateImageOnlyButton(
                "textrBtn08", "textures/ikon04.png"
            );

            textrBtn08.width = 0.5;
            textrBtn08.height = 0.9;
            textrBtn08.left = "-10%";
            karksTextureGrid.addControl(textrBtn08, 1, 1);

            var closeBtn1 = BABYLON.GUI.Button.CreateSimpleButton("closeBtn1", "X");
            closeBtn1.width = 0.5;
            closeBtn1.height = 0.9;
            closeBtn1.background = "red";
            closeBtn1.color = "white";
            closeBtn1.left = "-10%";
            karksTextureGrid.addControl(closeBtn1, 2, 1);

            //-------OBSERWABLE----------
            //editBtn---
            editBtn.onPointerClickObservable.add(() => {
                firstGrid.isVisible = true;
                editBtn.isVisible = false;
            });
            //==========firstGrid=============
                //Кнопки---
            
            //closeEditBtn---
            closeEditBtn.onPointerClickObservable.add(() => {
                firstGrid.isVisible = false;
                editBtn.isVisible = true;
            });

            //SidshkBtn---
            SidshkBtn.onPointerClickObservable.add(() => {
                firstGrid.isVisible = false;
                sidshkTextureGrid.isVisible = true;
            });

            //karksBtn---
            karksBtn.onPointerClickObservable.add(() => {
                firstGrid.isVisible = false;
                karksTextureGrid.isVisible = true;                             
            });

            //Слайдеры----

            //Слайдеры----
            xSlider.onValueChangedObservable.add(function (value) {
                textAxisX.text = "Ось X. Поворот " + (BABYLON.Tools.ToDegrees(value) | 0) + ".";
           if (camera) {
            camera.alpha = value;
        }
            });

            ySlider.onValueChangedObservable.add(function (value) {
                textAxisY.text = "Ось Y. Поворот " + (BABYLON.Tools.ToDegrees(value) | 0) + ".";
                    if (camera) {
            camera.beta = value;
        }
            });

            zSlider.onValueChangedObservable.add(function (value) {
                textAxisZ.text = "Расстояние " + value + ".";
                   if (camera) {
                        camera.radius = value;
                    }
            });
            
                        //==========sidshkTextureGrid============
            //Кнопки---
           textrBtn01.onPointerClickObservable.add(() => {
                sidushkaMat.baseTexture = new BABYLON.Texture("textures/texture05.png", scene);
                karksTextureNameText.text = "Текстура: texture05";
            });
            
              textrBtn02.onPointerClickObservable.add(() => {
                sidushkaMat.baseTexture = new BABYLON.Texture("textures/texture06.png", scene);
                karksTextureNameText.text = "Текстура: texture06";
            });

            textrBtn03.onPointerClickObservable.add(() => {
                sidushkaMat.baseTexture = new BABYLON.Texture("textures/texture07.png", scene);
                karksTextureNameText.text = "Текстура: texture07";
            });

            textrBtn04.onPointerClickObservable.add(() => {
                sidushkaMat.baseTexture = new BABYLON.Texture("textures/texture08.png", scene);
                karksTextureNameText.text = "Текстура: texture08";
            });

            closeBtn.onPointerClickObservable.add(() => {
                firstGrid.isVisible = true;
                sidshkTextureGrid.isVisible = false;
            });

            //===========karksTextureGrid=============  
  
            textrBtn05.onPointerClickObservable.add(() => {
                karkasMat.baseTexture = new BABYLON.Texture("textures/texture01.png", scene);
                karksTextureNameText.text = "Текстура: texture01";
            });

            textrBtn06.onPointerClickObservable.add(() => {
                karkasMat.baseTexture = new BABYLON.Texture("textures/texture02.png", scene);
                karksTextureNameText.text = "Текстура: texture02";
            });

            textrBtn07.onPointerClickObservable.add(() => {
                karkasMat.baseTexture = new BABYLON.Texture("textures/texture03.png", scene);
                karksTextureNameText.text = "Текстура: texture03";
            });

            textrBtn08.onPointerClickObservable.add(() => {
                karkasMat.baseTexture = new BABYLON.Texture("textures/texture04.png", scene);
                karksTextureNameText.text = "Текстура: texture04";
            });
            
            closeBtn1.onPointerClickObservable.add(() => {
                firstGrid.isVisible = true;
                karksTextureGrid.isVisible = false;
            });

         

            return scene;
        }
        window.initFunction = async function () {


            var asyncEngineCreation = async function () {
                try {
                    return createDefaultEngine();
                } catch (e) {
                    console.log("the available createEngine function failed. Creating the default engine instead");
                    return createDefaultEngine();
                }
            }

            window.engine = await asyncEngineCreation();
            if (!engine) throw 'engine should not be null.';
            startRenderLoop(engine, canvas);
            window.scene = createScene();
        };
        initFunction().then(() => {
            sceneToRender = scene
        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>
</html>
